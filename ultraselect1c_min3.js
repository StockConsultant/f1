if(jQuery){(function($){if(!String.prototype.trim){(function(){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}})()}var defaults={selectAll:true,maxlistitems:1,selectAllText:"ALL<div style='float:left;width:50px;'></div><div style='clear:both;'></div>",noneSelected:"Select",oneOrMoreSelected:"% selected",autoListSelected:false,optGroupSelectable:false,listHeight:250,maxWidth:false};function checkOverflow(el){var curOverflow=el.style.overflow;if(!curOverflow||curOverflow==="visible"){el.style.overflow="hidden"}var isOverflowing=el.clientWidth<el.scrollWidth;el.style.overflow=curOverflow;return isOverflowing}function adjustViewPort($options){var selectionBottom=$options.find(".selectable.hover").position().top+$options.find(".selectable.hover").outerHeight();if(selectionBottom>$options.innerHeight()){$options.scrollTop($options.scrollTop()+selectionBottom-$options.innerHeight())}if($options.find(".selectable.hover").position().top<0){$options.scrollTop($options.scrollTop()+$options.find(".selectable.hover").position().top)}}function updateMaxWidth(){var $select=this.children(".select");var $options=this.children(".options");var o=this.data("ultraselect").options;if(o.maxWidth){if($options.outerWidth()>$select.width()){$select.css("maxWidth",$options.outerWidth()+"px")}}}function updateOptGroup(optGroup){var o=this.data("ultraselect").options;if(o.optGroupSelectable){var optGroupSelected=true;$(optGroup).children(":not(.optGroupLabel)").find("input:checkbox").each(function(){if(!$(this).is(":checked")){optGroupSelected=false}});$(optGroup).find("input.optGroup").prop("checked",optGroupSelected).parent().toggleClass("checked",optGroupSelected)}}$.fn.selectAllItems=function(){var $select=this.children(".select"),$options=this.children(".options"),o=this.data("ultraselect").options,selectAll=true,selection=$select.find("span.selection");if(o.multiple){$options.find("input.selectAll").prop("checked",selectAll).parent().toggleClass("checked",selectAll);selection.html(o.selectAllText)}};$.fn.howmanyItems=function(){var $options=this.children(".options"),o=this.data("ultraselect").options,i=0;if(o.multiple){$options.find("input:checkbox").not(".selectAll, .optGroup").each(function(){i+=1})}return i};function updateSelected(change){var $select=this.children(".select");var $options=this.children(".options");var selection=$select.find("span.selection");var o=this.data("ultraselect").options;if(o.multiple){var i=0;var selectAll=true;var display="";$options.find("input:checkbox").not(".selectAll, .optGroup").each(function(){if($(this).is(":checked")){i+=1;display=display+$(this).parent().text().trim()+", "}else{selectAll=false}});display=display.replace(/\s*,\s*$/,"");if(i===0){$select.find("span.selection").html(o.noneSelected)}else{if(o.oneOrMoreSelected==="*"||o.autoListSelected){selection.html(display);$select.attr("title",display);if(o.autoListSelected){if(selectAll)selection.html(o.selectAllText);else if(i>o.maxlistitems){selection.html(o.oneOrMoreSelected.replace("%",i))}}}else{selection.html(o.oneOrMoreSelected.replace("%",i))}}if(o.selectAll){$options.find("input.selectAll").prop("checked",selectAll).parent().toggleClass("checked",selectAll)}}else{var value=this.children("input").val();$options.find(".option").each(function(){if($(this).data("value")===value){selection.html($("label",this).text());return false}})}if(change){this.trigger("change")}}var inc=0;function createOption(id,option,o){inc+=1;var uid=id+"_"+inc;var $option=$("<div />",{"class":"option"});var input=$("<input />",{type:"checkbox",name:o.name,id:uid,tabindex:-1});var label=$("<label />",{"for":uid});var spans=$("<span><span></span></span>");$option.addClass(option.classes||"").data(option.data);if(o.multiple){input.val(option.value);if(option.selected){input.prop("checked","checked")}return $option.append(input,label.append(spans,option.text)).addClass(option.classes||"").data(option.data)}else{$option.data("value",option.value);if(option.selected){$option.data("selected","selected")}return $option.addClass("selectable").append($("<label />").html(option.text))}}function createOptions(id,options,o){var uid;var i;var el;var label;var $options=$("<div />",{"class":"options"});for(i=0;i<options.length;i+=1){if(options[i].optgroup){el=$("<div />");el.attr("class",options[i].classes||null).addClass("optGroup").data(options[i].data);label=$("<label />");if(o.multiple&&o.optGroupSelectable){inc+=1;uid=id+"_"+inc;el.append($("<input />",{type:"checkbox","class":"optGroup",id:uid,tabindex:-1}));label.attr("for",uid).append("<span><span></span></span>")}el.append(label.append(options[i].optgroup)).wrapInner('<div class="optGroupLabel"></div>').append(createOptions(id,options[i].options,o));$options.append(el)}else{$options.append(createOption(id,options[i],o))}}return $options.children()}function buildOptions(options){inc+=1;var uid="selectAll_"+inc;var $ultraSelect=$(this);var $select=$ultraSelect.children(".select");var $options=$ultraSelect.children(".options");var US=this.data("ultraselect");var o=US.options;var callback=US.callback;$options.html("");if(o.multiple&&o.selectAll){$options.append($("<div />",{"class":"selectAll"}).append($("<input />",{type:"checkbox","class":"selectAll",id:uid,tabindex:-1}),$("<label />",{"for":uid}).append("<span><span></span></span>",o.selectAllText)))}$options.append(createOptions(this.attr("id"),options,o));$ultraSelect.ultraselect("setListHeight",o.listHeight);if(o.multiple){if(o.multiple&&o.selectAll){$options.find("input.selectAll").click(function(){$options.find("input:checkbox").prop("checked",$(this).is(":checked")).parent().toggleClass("checked",$(this).is(":checked"))})}if(o.multiple&&o.optGroupSelectable){$options.addClass("optGroupHasCheckboxes");$options.find("input.optGroup").click(function(){$(this).parent().parent().find("input:not(.optGroup, .selectAll):checkbox").prop("checked",$(this).is(":checked")).parent().toggleClass("checked",$(this).is(":checked"))})}$options.find("input:checkbox").click(function(){$(this).parent().toggleClass("checked",$(this).is(":checked"));updateSelected.call($ultraSelect,true);$select.focus();if($(this).parent().parent().hasClass("optGroup")){updateOptGroup.call($ultraSelect,$(this).parent().parent())}if(callback){callback($(this))}});$options.each(function(){$(this).find("input:checked").parent().addClass("checked")});updateSelected.call($ultraSelect,false);if(o.optGroupSelectable){$options.find("div.optGroup").each(function(){updateOptGroup.call($ultraSelect,$(this))})}$options.find("input:checkbox").parent().addClass("selectable")}else{updateSelected.call($ultraSelect,false);$(".option",$options).click(function(){$("input",$ultraSelect).val($(this).data("value"));$ultraSelect.ultraselect("hideOptions");updateSelected.call($ultraSelect,true);$select.focus()})}$options.find(".selectable").hover(function(){$(this).parent().find(".hover").removeClass("hover");$(this).addClass("hover")},function(){if(o.multiple){$(this).removeClass("hover")}});$select.keydown(function(e){$options=$(this).next(".options");var allOptions;var oldHoverIndex;var newHoverIndex;if($ultraSelect.parent().css("overflow")!=="hidden"){if(e.keyCode===9){$(this).addClass("focus").trigger("click");return true}if(e.keyCode===27||e.keyCode===37||e.keyCode===39){$(this).addClass("focus").trigger("click")}if(e.keyCode===40||e.keyCode===38){allOptions=$options.find(".selectable");oldHoverIndex=allOptions.index(allOptions.filter(".hover"));newHoverIndex=-1;if(oldHoverIndex<0){$options.find(".selectable:first").addClass("hover")}else if(e.keyCode===40&&oldHoverIndex<allOptions.length-1){newHoverIndex=oldHoverIndex+1}else if(e.keyCode===38&&oldHoverIndex>0){newHoverIndex=oldHoverIndex-1}if(newHoverIndex>=0){$(allOptions.get(oldHoverIndex)).removeClass("hover");$(allOptions.get(newHoverIndex)).addClass("hover");adjustViewPort($options)}return false}if(e.keyCode===13||e.keyCode===32){if(!o.multiple){$(".option.hover",$options).trigger("click")}var selectedCheckbox=$options.find("div.hover input:checkbox");selectedCheckbox.prop("checked",!selectedCheckbox.is(":checked")).parent().toggleClass("checked",selectedCheckbox.is(":checked"));if(selectedCheckbox.hasClass("selectAll")){$options.find("input:checkbox").prop("checked",selectedCheckbox.is(":checked")).parent().addClass("checked").toggleClass("checked",selectedCheckbox.is(":checked"))}updateSelected.call($ultraSelect,true);if(callback){callback($(this))}return false}if(e.keyCode>=33&&e.keyCode<=126){var match=$options.find(".selectable:startsWith("+String.fromCharCode(e.keyCode)+")");var currentHoverIndex=match.index(match.filter(".selectable.hover"));var afterHoverMatch=match.filter(function(index){return index>currentHoverIndex});match=afterHoverMatch.length>=1?afterHoverMatch:match;match=match.filter(".selectable:first");if(match.length===1){$options.find(".selectable.hover").removeClass("hover");match.addClass("hover");adjustViewPort($options)}}}else{if(!o.multiple&&(e.keyCode===40||e.keyCode===38)){allOptions=$options.find(".selectable");oldHoverIndex=allOptions.index(allOptions.filter(".hover"));newHoverIndex=oldHoverIndex;if(oldHoverIndex<0){newHoverIndex=0}else if(e.keyCode===40&&oldHoverIndex<allOptions.length-1){newHoverIndex=oldHoverIndex+1}else if(e.keyCode===38&&oldHoverIndex>0){newHoverIndex=oldHoverIndex-1}allOptions.removeClass("hover");$(allOptions.get(newHoverIndex)).addClass("hover").trigger("click");return false}if(e.keyCode===38||e.keyCode===40||e.keyCode===13||e.keyCode===32){$(this).removeClass("focus").trigger("click");$options.find(".selectable:first").addClass("hover");return false}if(e.keyCode===9){return true}}if(e.keyCode===13){return false}})}function UltraSelect(element,options,callback){this.element=element;this.options=$.extend(true,{},defaults,options);this.callback=callback;this.init()}$.extend(UltraSelect.prototype,{init:function(){var conf=this.options;var select=$(this.element);conf.maxWidth=select.css("maxWidth")!=="none"?select.css("maxWidth"):conf.maxWidth;conf.multiple=select.attr("multiple");conf.name=select.attr("name");var $ultraSelect=$("<div />",{"class":"ultraselect"});var $select=$("<div />",{"class":"select",tabIndex:0});var $options=$("<div />",{"class":"options",tabIndex:-1});if(!conf.multiple){$ultraSelect.append($("<input />",{type:"hidden",name:conf.name,value:select.val()}))}$select.append($("<span />",{"class":"selection"}),$("<span />",{"class":"arrow"}).append($("<b />")));$ultraSelect.append($select,$options);select.after($ultraSelect);if(conf.maxWidth){$select.css("maxWidth",conf.maxWidth)}$ultraSelect.addClass(select.attr("class"));$ultraSelect.data(select.data());this.element=$ultraSelect[0];$ultraSelect.data("ultraselect",this);var options=[];select.children().each(function(){if(this.tagName.toLowerCase()==="optgroup"){var suboptions=[];options.push({optgroup:$(this).attr("label"),options:suboptions,classes:$(this).attr("class"),data:$(this).data()||{}});$(this).children("option").each(function(){if($(this).val()!==""){suboptions.push({text:$(this).html(),value:$(this).val(),selected:$(this).prop("selected"),classes:$(this).attr("class"),data:$(this).data()||{}})}})}else if(this.tagName.toLowerCase()==="option"){if($(this).val()!==""){options.push({text:$(this).html(),value:$(this).val(),selected:$(this).prop("selected"),classes:$(this).attr("class"),data:$(this).data()||{}})}}});select.remove();$ultraSelect.attr("id",select.attr("id"));buildOptions.call($ultraSelect,options);$ultraSelect.wrap('<div class="ultraselectWrapper"></div>');$ultraSelect.parent().height($select.outerHeight());updateMaxWidth.call($ultraSelect);$(window).resize(function(){updateMaxWidth.call($ultraSelect)});$select.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){if($(this).hasClass("active")){$ultraSelect.ultraselect("hideOptions")}else{$ultraSelect.ultraselect("showOptions")}return false}).focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")});$(document).click(function(event){if(!$(event.target).parents().addBack().is(".ultraselect > .options")){$ultraSelect.ultraselect("hideOptions")}})},getValue:function(){var selected=[];if(this.options.multiple){$("input:not(.selectAll, .optGroup)",this.element).each(function(){if($(this).is(":checked")){selected.push($(this).val())}})}else{return $("input",this.element).val()}return selected},setValue:function(value){var element=this.element;if(!this.options.multiple){$("input",element).val(value);$(".option",element).removeClass("hover").each(function(){if($(this).val()===value){$(this).addClass("hover");$("span.selection",element).html($("label",this).text())}})}var normalized=value?value:[];if(typeof normalized==="string"){normalized=[value]}normalized='"'+value+'"';$("input:not(.selectAll, .optGroup)",element).each(function(){var checked=normalized.indexOf($(this).val())!==-1;$(this).prop("checked",checked).parent().toggleClass("checked",checked)});updateSelected.call($(element),false);return this},update:function(){updateSelected.call(this)},updateOptions:function(options){buildOptions.call(this,options)},hideOptions:function(){this.children(".select").removeClass("active").removeClass("hover");this.parent().css("overflow","hidden");this.parent().css("z-index","1")},showOptions:function(){var $select=this.children(".select");var $options=this.children(".options");var o=this.data("ultraselect").options;$(".ultraselect").ultraselect("hideOptions");this.parent().css("overflow","visible");this.parent().css("z-index","99");$options.find(".option, .optGroup").removeClass("hover");$select.addClass("active").focus();if(o.multiple){$options.scrollTop(0)}else{var value=this.children("input").val();$options.find(".option").each(function(){if($(this).data("value")===value){$(this).addClass("hover");return false}})}},selectedString:function(){var selectedValues="";this.find("input:checkbox:checked").not(".optGroup, .selectAll").each(function(){selectedValues+=$(this).attr("value")+","});return selectedValues.replace(/\s*,\s*$/,"")},setListHeight:function(listHeight){var $options=this.children(".options");if(navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident/7.")>=0||navigator.userAgent.toLowerCase().indexOf("firefox")>=0||navigator.userAgent.indexOf("Edge/1")>=0){$options.addClass("_firefox")}if($options.height()>listHeight){$options.css("height",listHeight+"px")}},option:function(key,value,update){if(typeof value==="undefined"){return this.data("ultraselect").options[key]}else{this.data("ultraselect").options[key]=value;if(update){updateSelected.call(this,true)}}}});$.expr[":"].startsWith=function(el,ignore,m){var search=m[3];if(!search){return false}return new RegExp("^[/s]*"+search,"i").test($(el).text())};var $valFn=$.fn.val;$.fn.val=function(value){var US;if(arguments.length===0){US=this.data("ultraselect");if(US){return US.getValue()}else{return $valFn.call(this)}}else{return this.each(function(){US=$(this).data("ultraselect");if(US){US.setValue(value)}else{$valFn.call($(this),value)}})}};$.fn.ultraselect=function(options,callback){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){if(!$(this).data("ultraselect")){new UltraSelect(this,options,callback)}else if(typeof options==="string"&&typeof UltraSelect.prototype[options]==="function"){$(this).data("ultraselect")[options].apply($(this),args)}else{console.log("ultraselect: invalid arguments")}})}})(jQuery)}