var myConfig,thetimeout,days,origdays,j,resizeTimer,lastwinwidth,dwidth,wininnerw,wininnerh,errorstr="",xhr=[],xhrnum=0,currentsdate="1",currentsfidx="1",cgiprog="screaltime1b5",hadtowaitglob=0,apidatafail=0,onetime=0,stickchart=0,timeoutsecs=0;function initconfig(){myConfig={"background-color":"#000000",type:"mixed",title:{text:""},crosshairX:{lineColor:"#999",lineStyle:"dotted"},crosshairY:{lineColor:"#999",lineStyle:"dotted",scaleLabel:{fontSize:"13px","font-family":"Arial","font-color":"#f3f3f3","background-color":"#555"}},plot:{tooltip:{visible:!1},mode:"fast",exact:!0,smartSampling:!1,maxNodes:"100",maxTrackers:"100"},plotarea:{"background-color":"#000",margin:"dynamic",marginRightOffset:"3px"},scaleX:{itemsOverlap:!0,"max-items":100,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px",rules:[{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.7"}]},tick:{alpha:"0",color:"#ddd",rules:[{rule:'"%scale-label" != "" || "%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"1"}]},guide:{visible:!0,zIndex:"0","line-color":"#444","line-style":"solid",alpha:"0",rules:[{rule:' "%scale-label" != "" || "%scale-label" == "10 " || "%scale-label" == "11 " || "%scale-label" == "12 " || "%scale-label" == "01"|| "%scale-label" == "02" || "%scale-label" == "03"',alpha:"1"},{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.6"}]},labels:[]},scaleY:{type:"log",itemsOverlap:!0,"max-items":50,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px"},placement:"opposite",decimals:"1","offset-start":"19%",format:"%v",values:"0:1:1",guide:{"line-style":"dotted",zIndex:"0","line-color":"#666"},label:{text:""}},scaleY2:{"max-items":3,item:{"font-family":"Arial",color:"#777",fontSize:"9px"},blended:!0,"offset-end":"86%",placement:"opposite","exponent-decimals":"0",format:"%v",values:"0:1:1",guide:{"line-style":"solid",zIndex:"0","line-color":"#333"},label:{text:""}},series:[{type:"bar",scales:"scaleX,scaleY2",guideLabel:{visible:!1},"background-color":"#00ef00",stacked:!0,"bar-width":"90%",values:[]},{type:"bar",guideLabel:{visible:!1},scales:"scaleX,scaleY2","background-color":"#ef0000",stacked:!0,"bar-width":"90%",values:[]},{type:"stock",scales:"scaleX,scaleY",zIndex:"2",aspect:"candlestick","bar-width":"100%",guideLabel:{visible:!1},"trend-up":{"background-color":"#000","line-color":"#00ef00","border-color":"#00ef00"},"trend-down":{"background-color":"#ef0000","line-color":"#ff645b","border-color":"#ef0000"},"trend-equal":{"background-color":"#00ef00","line-color":"#00ef00","border-color":"#00ef00"},values:[]},{aspect:"spline",scales:"scaleX,scaleY",guideLabel:{visible:!1},zIndex:"1",marker:{visible:"false"},lineColor:"#7777cc",lineWidth:"1px",values:[]}]}}function decodedata(e){var a,l,s,i,t="",o=12,n=0,r=1;if(timeoutsecs=0,1==debugg&&(l=new Date),null!=e){if(1==debugg&&(console.log(e),console.log("apidatafail="+apidatafail)),(t=e).length>=1&&t.length<=12&&t.indexOf("]")<0)if("9"==t)r=0,apidatafail=0,hadtowaitglob=0;else if("6"==t)n=1,apidatafail++;else if("5"==t)n=1,hadtowaitglob++;else if("1"==t.charAt(0)){if(t.indexOf(",")>0){var c=t.split(",");c=parseFloat(c[1]),timeoutsecs=c>=1&&c<=3750?c:60}n=1,apidatafail=0,hadtowaitglob=0}if(0==r&&(document.getElementById("status").innerHTML=symbolin+"</span> no chart"),1==debugg&&(console.log("*********************************** nochartupdate="+n),console.log("before currentsdate="+currentsdate+"  currentsfidx="+currentsfidx)),1==r&&0==n){t=t.split("~"),(days>=t.length||(days=origdays)>=t.length)&&(days=t.length);var d,g,f,u,m,y,b,h="",p="",v=[1,78,39,26,13,13,7,7,7,7,7],C=[1,6,3,2,1,1,1,1,1,1,1],w=-1,x=99999999,X=[],I=0,k=0,z=[0,0,0],T=0,Y=0;for(initconfig(),b=t.length-1;b>=0;b--){if(u=t[b].indexOf("]"),5!=(m=t[b].substr(0,u).split(",")).length||u<0){Y=1;break}if(h=m[0].substr(6,2),p=t[b].substr(u+1).split("["),0==b){if(currentsdate=m[0],currentsfidx=m[1],"1"==m[3]?apidatafail++:apidatafail=0,"1"==m[2]?hadtowaitglob++:hadtowaitglob=0,0==timeoutsecs&&5==m.length){c=parseFloat(m[4]);timeoutsecs=c>=1&&c<=3750?c:60}1==debugg&&console.log("j="+b+"  currentsdate="+currentsdate+"  currentsfidx="+currentsfidx+"  dataslots[days]="+v[days])}if(g=0,(f=p.length)<v[days])for(var F=v[days]-f,S=0;S<F;S++)1==t.length?p.unshift(""):p.push("");d=-1;var E=0;for(S=-1;S<=v[days];S++){if(-1==S||S==v[days])S==v[days]&&0!=b?I--:(myConfig.scaleX.labels[I]="",myConfig.series[2].values.push([0,0,0,0]),myConfig.series[0].values[I]=0,myConfig.series[1].values[I]=0,myConfig.series[3].values[I]=null);else if(days>1||1==days&&1==E||""!=p[S]){E=1;var B=g/C[days];if(B-Math.floor(B)==0&&B%2==1)myConfig.scaleX.labels[I]=B>5?.5*(B-1)-2:.5*(B-1)+10,2==days&&10==myConfig.scaleX.labels[I]||days>=3&&(10==myConfig.scaleX.labels[I]||12==myConfig.scaleX.labels[I]||2==myConfig.scaleX.labels[I])?myConfig.scaleX.labels[I]="":5!=days||10!=myConfig.scaleX.labels[I]&&11!=myConfig.scaleX.labels[I]&&12!=myConfig.scaleX.labels[I]&&2!=myConfig.scaleX.labels[I]&&3!=myConfig.scaleX.labels[I]?days>5&&(myConfig.scaleX.labels[I]=""):myConfig.scaleX.labels[I]="",""!=myConfig.scaleX.labels[I]&&(myConfig.scaleX.labels[I]<12&&myConfig.scaleX.labels[I]>9?myConfig.scaleX.labels[I]+="a":myConfig.scaleX.labels[I]+="p");else if(0==g){var D=parseInt(h);myConfig.scaleX.labels[I]=D<10?h:10==D||11==D||12==D?parseInt(h)+" ":h}else myConfig.scaleX.labels[I]="";if(g++,""!=p[S])if(5==(y=p[S].split(",")).length&&""!=y[3]){var A=parseFloat(y[1]),L=parseFloat(y[2]),W=parseInt(y[4]),O=parseFloat(y[0]),H=parseFloat(y[3]);if(A>w&&(w=A),L<x&&(x=L),myConfig.series[2].values.push([O,A,L,H]),W>k&&(k=W),H<O?(myConfig.series[1].values[I]=W,myConfig.series[0].values[I]=0):(myConfig.series[0].values[I]=W,myConfig.series[1].values[I]=0),W>z[0]?(z[2]=z[1],z[1]=z[0],z[0]=W):W>z[1]?(z[2]=z[1],z[1]=W):W>z[2]&&(z[2]=W),T++,d=parseFloat(y[3]),X.unshift(parseFloat(y[3])),X.length>=o){var M=0;for(j=0;j<o;j++)M+=X[j];myConfig.series[3].values[I]=parseFloat((M/o).toFixed(3))}else myConfig.series[3].values[I]=null}else if(d>0)if(myConfig.series[2].values.push([d,d,d,d]),myConfig.series[0].values[I]=0,myConfig.series[1].values[I]=0,X.unshift(d),X.length>=o){var j;M=0;for(j=0;j<o;j++)M+=X[j];myConfig.series[3].values[I]=parseFloat((M/o).toFixed(3))}else myConfig.series[3].values[I]=null;else myConfig.series[2].values.push([0,0,0,0]),myConfig.series[0].values[I]=0,myConfig.series[1].values[I]=0,myConfig.series[3].values[I]=null;else myConfig.series[2].values.push([0,0,0,0]),myConfig.series[0].values[I]=0,myConfig.series[1].values[I]=0,myConfig.series[3].values[I]=null}else myConfig.scaleX.labels[I]="",myConfig.series[2].values.push([0,0,0,0]),myConfig.series[0].values[I]=0,myConfig.series[1].values[I]=0,myConfig.series[3].values[I]=null;I++}}if(!Y){-1!=w&&99999999!=x&&(myConfig.scaleY.values=dwidth<510?x+":"+w+":"+.125*(w-x):x+":"+w+":"+.1*(w-x),myConfig.scaleY.decimals=x<1?"3":x<1e3?"2":"1");var U=0;T>20&&z[0]>2*z[2]&&(U=1,k=z[2]);var _=parseInt(.02*k);for(b=0;b<I;b++)1==U&&(myConfig.series[0].values[b]==z[0]&&(myConfig.series[0].values[b]=z[2]),myConfig.series[1].values[b]==z[0]&&(myConfig.series[1].values[b]=z[2]),myConfig.series[0].values[b]==z[1]&&(myConfig.series[0].values[b]=z[2]),myConfig.series[1].values[b]==z[1]&&(myConfig.series[1].values[b]=z[2])),myConfig.series[0].values[b]>0&&myConfig.series[0].values[b]<_&&(myConfig.series[0].values[b]=_),myConfig.series[1].values[b]>0&&myConfig.series[1].values[b]<_&&(myConfig.series[1].values[b]=_),myConfig.scaleX.labels[b]=myConfig.scaleX.labels[b].toString();k>0&&(myConfig.scaleY2.values="0:"+k+":"+parseInt(.5*k)),dwidth<510&&(myConfig.series[0].barWidth="60%",myConfig.series[1].barWidth="60%"),myConfig.series[2].aspect=0==stickchart?"candlestick":"whisker",(w<10&&k>49900||w<100&&k>499e3)&&(myConfig.scaleY2.exponent=!0,myConfig.scaleY2.item.fontSize="10px"),1==debugg&&(s=new Date,console.log("setup vars time="+(s.getTime()-l.getTime())/1e3),a=new Date),zingchart.render({id:"myChart",data:myConfig,height:"100%",width:"100%"}),zingchart.bind("myChart","contextmenu",(function(e){return e.ev.preventDefault(),!1})),zingchart.bind("myChart","mousewheel",(function(e){return e.ev.preventDefault(),!1})),zingchart.bind("myChart","swipe",(function(e){return e.ev.preventDefault(),!1})),1==debugg&&(i=new Date,console.log("setup render time="+(i.getTime()-a.getTime())/1e3))}}}}function cyclechart(){0==onetime&&1!=apidatafail&&1!=hadtowaitglob&&(hadtowaitglob=0,apidatafail=0,0==(timeoutsecs=parseInt(1e3*timeoutsecs))&&(timeoutsecs=6e4),1==debugg&&console.log("normal getting data secs="+timeoutsecs),thetimeout=setTimeout((function(){getdata()}),timeoutsecs)),1==apidatafail?(hadtowaitglob=0,1==debugg&&console.log("api fail or timeout getting data 1 secs"),thetimeout=setTimeout((function(){getdata()}),1e3)):apidatafail=0,0==onetime&&1==hadtowaitglob?(1==debugg&&console.log("had to wait getting data 5 secs"),thetimeout=setTimeout((function(){getdata()}),5e3)):hadtowaitglob=0}function sleep(e){return new Promise((a=>setTimeout(a,e)))}async function loopuntilzload(e){var a,l;for(a=1;a<maxloadtries;a++){if(1==zingloaded)return 1==debugg&&console.log("zingloaded in times="+a),decodedata(e),void cyclechart();l=a<=3?20:a<=5?40:100,await sleep(l)}}function getinput(){wininnerw=window.innerWidth,wininnerh=window.innerHeight;var e=0,a=window.location.search.substr(1).split(","),l=document.getElementById("myChart"),s=document.getElementById("dataline");if(s.style.height=topdatalinepx,s.style.top=topdatalineoffspx,dwidth=l.offsetWidth,l.style.height=zinght,l.style.height=document.getElementById("myChart").offsetHeight-document.getElementById("dataline").offsetHeight-1+"px",window.location.search.length<20&&(4!=a.length?e=1:(((days=parseInt(a[1]))<1||days>10||4==days)&&(e=1),symbolin=a[0],symbolin.length>7&&(e=1),0!=onetime&&1!=onetime&&(e=1),stickchart=a[3]),0==e)){origdays=days,document.getElementById("symid").value=symbolin.toUpperCase();var i=document.getElementById("daysel");1==days?i.selectedIndex=0:2==days?i.selectedIndex=1:3==days?i.selectedIndex=2:5==days?i.selectedIndex=3:10==days&&(i.selectedIndex=4),getdata()}document.getElementById("symid").onkeyup=function(){this.value=this.value.toUpperCase()},lastwinwidth=window.innerWidth,window.addEventListener("resize",(function(){clearTimeout(resizeTimer),resizeTimer=setTimeout((function(){(window.innerWidth<lastwinwidth-1||window.innerWidth>lastwinwidth+1)&&(window.location.href=window.location.href)}),250)}))}function spawnwindow(e){var a="https://www.stockconsultant.com/consultnow/rtime1b_multi.html?"+document.getElementById("symid").value+","+document.getElementById("daysel").value+","+onetime+","+stickchart;if(1==e){var l=window.open(a,"_blank","resizable=1,directories=0,toolbar=0,location=0,menubar=0,status=0,scrollbars=0,width="+wininnerw+",height="+wininnerh+",left=20,top=20,screenX=20,screenY=20");l&&!l.closed&&l.focus()}else window.location.replace(a)}var globerr,startt,endt,maxloadtries=95;function getdata(){if(timeoutsecs=0,thetimeout&&clearTimeout(thetimeout),0==onetime&&document.hidden)return 1==debugg&&console.log("I was hidden"),void(thetimeout=setTimeout(getdata,1e3));1==debugg&&console.log("getting data func days="+origdays);var e=new AbortController,a=parseInt(5e6*Math.random());globerr=0;var l=setTimeout((()=>e.abort()),4500);fetch("https://www.stockconsultant.com/consultnow/"+cgiprog+".cgi?SYMBOL="+symbolin+"&DAYS="+origdays+"&SDATE="+currentsdate+"&SFIDX="+currentsfidx+"&"+a,{signal:e.signal}).then((e=>(clearTimeout(l),e.ok||(globerr=1,apidatafail++,cyclechart()),e.text()))).then((e=>{0==globerr&&loopuntilzload(e)})).catch((e=>{clearTimeout(l),0==globerr&&(apidatafail++,cyclechart())}))}