var myConfig,thetimeout,days,origdays,j,errorstr="",xhr=[],xhrnum=0,currentsdate="1",currentsfidx="1",cgiprog="screaltime1b5",hadtowaitglob=0,apidatafail=0,onetime=1,stickchart=0;function initconfig(){myConfig={"background-color":"#000",type:"mixed",title:{text:""},plot:{tooltip:{visible:!1},mode:"fast",exact:!0,smartSampling:!1,maxNodes:"100",maxTrackers:"100"},plotarea:{"background-color":"#000",margin:"dynamic"},scaleX:{itemsOverlap:!0,"max-items":100,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px",rules:[{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.7"}]},tick:{alpha:"0",color:"#ddd",rules:[{rule:'"%scale-label" != "" || "%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"1"}]},guide:{visible:!0,zIndex:"0","line-color":"#383838","line-style":"solid",alpha:"0",rules:[{rule:' "%scale-label" != "" || "%scale-label" == "10 " || "%scale-label" == "11 " || "%scale-label" == "12 " || "%scale-label" == "01"|| "%scale-label" == "02" || "%scale-label" == "03"',alpha:"1"},{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.6"}]},labels:[]},scaleY:{itemsOverlap:!0,"max-items":50,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px"},placement:"opposite",decimals:"1","offset-start":"19%",format:"%v",values:"0:1:1",guide:{"line-style":"dotted",zIndex:"0","line-color":"#555"},label:{text:""}},scaleY2:{"max-items":3,item:{"font-family":"Arial",color:"#777",fontSize:"9px"},blended:!0,"offset-end":"86%",placement:"opposite","exponent-decimals":"0",format:"%v",values:"0:1:1",guide:{"line-style":"solid",zIndex:"0","line-color":"#333"},label:{text:""}},series:[{type:"stock",scales:"scaleX,scaleY",zIndex:"1",aspect:"candlestick","bar-width":"100%","trend-up":{"background-color":"#000","line-color":"#00ff00","border-color":"#00ff00"},"trend-down":{"background-color":"#ff1111","line-color":"#ff1111","border-color":"#ff1111"},"trend-equal":{"background-color":"#00ff00","line-color":"#00ff00","border-color":"#00ff00"},values:[]},{type:"bar",scales:"scaleX,scaleY2","background-color":"#00ff00",stacked:!0,"bar-width":"90%",values:[]},{scales:"scaleX,scaleY",zIndex:"0",marker:{visible:"false"},aspect:"spline",lineColor:"#BF48BF",lineWidth:"1px",values:[]},{type:"bar",scales:"scaleX,scaleY2","background-color":"#ff1111",stacked:!0,"bar-width":"90%",values:[]}]}}function decodedata(e){var l,a,s,i,t="",o=0,n=1;if(timeoutsecs=0,1==debugg&&(a=new Date),void 0!=e){if(1==debugg&&(console.log(e),console.log("apidatafail="+apidatafail)),(t=e).length>=1&&t.length<=11){if("9"==t)n=0,apidatafail=0,hadtowaitglob=0;else if("6"==t)o=1,apidatafail++;else if("5"==t)o=1,hadtowaitglob++;else if("1"==t.charAt(0)){if(t.indexOf(",")>0){var $=t.split(",");timeoutsecs=($=parseFloat($[1]))>=1&&$<=3650?$:60}o=1,apidatafail=0,hadtowaitglob=0}}if(0==n&&(document.getElementById("status").innerHTML=symbolin+"</span> no chart"),1==debugg&&console.log("*********************************** nochartupdate="+o),1==debugg&&console.log("before currentsdate="+currentsdate+"  currentsfidx="+currentsfidx),1==n&&0==o){days>=(t=t.split("~")).length?days=t.length:(days=origdays)>=t.length&&(days=t.length);var r,f,_,c,d,g,u,m,y,h,b=[1,78,39,26,13,13,7,7,7,7,7],C=[1,6,3,2,1,1,1,1,1,1,1],p=-1,v=99999999,x=[],w=0,X=0,k=[0,0,0],z=0;for(initconfig(),h=t.length-1;h>=0;h--){if(d=t[h].indexOf("]"),u=(g=t[h].substr(0,d).split(","))[0].substr(6,2),m=t[h].substr(d+1).split("["),0==h){if(currentsdate=g[0],currentsfidx=g[1],"1"==g[3]?apidatafail++:apidatafail=0,"1"==g[2]?hadtowaitglob++:hadtowaitglob=0,0==timeoutsecs&&5==g.length){var $=parseFloat(g[4]);timeoutsecs=$>=1&&$<=3650?$:60}1==debugg&&console.log("j="+h+"  currentsdate="+currentsdate+"  currentsfidx="+currentsfidx+"  dataslots[days]="+b[days])}c=m.length,_=0;var Y=b[days]-c;if(1==t.length){if(c<b[days])for(f=0;f<Y;f++)m.unshift("")}else if(c<b[days])for(f=0;f<Y;f++)m.push("");r=-1;var S=0;for(f=-1;f<=b[days];f++){if(-1==f||f==b[days])f==b[days]&&0!=h?w--:(myConfig.scaleX.labels[w]="",myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[w]=0,myConfig.series[3].values[w]=0,myConfig.series[2].values[w]=null);else if(days>1||1==days&&1==S||""!=m[f]){S=1;var I=_/C[days];if(I-Math.floor(I)==0&&I%2==1)I>5?myConfig.scaleX.labels[w]=(I-1)*.5-2:myConfig.scaleX.labels[w]=(I-1)*.5+10,2==days&&10==myConfig.scaleX.labels[w]?myConfig.scaleX.labels[w]="":days>=3&&(10==myConfig.scaleX.labels[w]||12==myConfig.scaleX.labels[w]||2==myConfig.scaleX.labels[w])?myConfig.scaleX.labels[w]="":5==days&&(10==myConfig.scaleX.labels[w]||11==myConfig.scaleX.labels[w]||12==myConfig.scaleX.labels[w]||2==myConfig.scaleX.labels[w]||3==myConfig.scaleX.labels[w])?myConfig.scaleX.labels[w]="":days>5&&(myConfig.scaleX.labels[w]=""),""!=myConfig.scaleX.labels[w]&&(myConfig.scaleX.labels[w]<12&&myConfig.scaleX.labels[w]>9?myConfig.scaleX.labels[w]+="a":myConfig.scaleX.labels[w]+="p");else if(0==_){var T=parseInt(u);T<10?myConfig.scaleX.labels[w]=u:10==T||11==T||12==T?myConfig.scaleX.labels[w]=parseInt(u)+" ":myConfig.scaleX.labels[w]=u}else myConfig.scaleX.labels[w]="";if(_++,""!=m[f]){if(""!=(y=m[f].split(","))[3]){var A=parseFloat(y[1]),B=parseFloat(y[2]),F=parseInt(y[4]),O=parseFloat(y[0]),W=parseFloat(y[3]);if(A>p&&(p=A),B<v&&(v=B),myConfig.series[0].values.push([O,A,B,W]),F>X&&(X=F),W<O?(myConfig.series[3].values[w]=F,myConfig.series[1].values[w]=0):(myConfig.series[1].values[w]=F,myConfig.series[3].values[w]=0),F>k[0]?(k[2]=k[1],k[1]=k[0],k[0]=F):F>k[1]?(k[2]=k[1],k[1]=F):F>k[2]&&(k[2]=F),z++,r=parseFloat(y[3]),x.unshift(parseFloat(y[3])),x.length>=12){var D,E=0;for(D=0;D<12;D++)E+=x[D];myConfig.series[2].values[w]=parseFloat((E/12).toFixed(3))}else myConfig.series[2].values[w]=null}else if(r>0){if(myConfig.series[0].values.push([r,r,r,r]),myConfig.series[1].values[w]=0,myConfig.series[3].values[w]=0,x.unshift(r),x.length>=12){var D,E=0;for(D=0;D<12;D++)E+=x[D];myConfig.series[2].values[w]=parseFloat((E/12).toFixed(3))}else myConfig.series[2].values[w]=null}else myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[w]=0,myConfig.series[3].values[w]=0,myConfig.series[2].values[w]=null}else myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[w]=0,myConfig.series[3].values[w]=0,myConfig.series[2].values[w]=null}else myConfig.scaleX.labels[w]="",myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[w]=0,myConfig.series[3].values[w]=0,myConfig.series[2].values[w]=null;w++}}-1!=p&&99999999!=v&&(dwidth<510?myConfig.scaleY.values=v+":"+p+":"+(p-v)*.125:myConfig.scaleY.values=v+":"+p+":"+(p-v)*.1,v<1?myConfig.scaleY.decimals="3":v<1e3?myConfig.scaleY.decimals="2":myConfig.scaleY.decimals="1");var H=0;z>20&&k[0]>2*k[2]&&(H=1,X=k[2]);var L=parseInt(.02*X);for(h=0;h<w;h++)1==H&&(myConfig.series[1].values[h]==k[0]&&(myConfig.series[1].values[h]=k[2]),myConfig.series[3].values[h]==k[0]&&(myConfig.series[3].values[h]=k[2]),myConfig.series[1].values[h]==k[1]&&(myConfig.series[1].values[h]=k[2]),myConfig.series[3].values[h]==k[1]&&(myConfig.series[3].values[h]=k[2])),myConfig.series[1].values[h]>0&&myConfig.series[1].values[h]<L&&(myConfig.series[1].values[h]=L),myConfig.series[3].values[h]>0&&myConfig.series[3].values[h]<L&&(myConfig.series[3].values[h]=L),myConfig.scaleX.labels[h]=myConfig.scaleX.labels[h].toString();X>0&&(myConfig.scaleY2.values="0:"+X+":"+parseInt(.5*X)),dwidth<510&&(myConfig.series[1].barWidth="60%",myConfig.series[3].barWidth="60%"),0==stickchart?myConfig.series[0].aspect="candlestick":myConfig.series[0].aspect="whisker",p<10&&X>49900?(myConfig.scaleY2.exponent=!0,myConfig.scaleY2.item.fontSize="10px"):p<100&&X>499e3&&(myConfig.scaleY2.exponent=!0,myConfig.scaleY2.item.fontSize="10px"),1==debugg&&(s=new Date,console.log("setup vars time="+(s.getTime()-a.getTime())/1e3),l=new Date),zingchart.render({id:"myChart",data:myConfig,height:"100%",width:"100%"}),zingchart.bind("myChart","contextmenu",function(e){return!1}),zingchart.bind("myChart","mousewheel",function(e){return!1}),zingchart.bind("myChart","swipe",function(e){return!1}),1==debugg&&(i=new Date,console.log("setup render time="+(i.getTime()-l.getTime())/1e3))}}}function cyclechart(){0==onetime&&1!=apidatafail&&1!=hadtowaitglob&&(hadtowaitglob=0,apidatafail=0,0==(timeoutsecs=parseInt(1e3*timeoutsecs))&&(timeoutsecs=6e4),1==debugg&&console.log("normal getting data secs="+timeoutsecs),thetimeout=setTimeout(function(){getdata()},timeoutsecs)),1==apidatafail?(hadtowaitglob=0,1==debugg&&console.log("api fail or timeout getting data 1 secs"),thetimeout=setTimeout(function(){getdata()},1e3)):apidatafail=0,0==onetime&&1==hadtowaitglob?(1==debugg&&console.log("had to wait getting data 5 secs"),thetimeout=setTimeout(function(){getdata()},5e3)):hadtowaitglob=0}function loopuntilzload(e){if(1==zingloaded)1==debugg&&console.log("zingloaded in times="+zloadtries),decodedata(e),cyclechart();else{if(++zloadtries>maxloadtries)return;var l=100;zloadtries<=3?l=20:zloadtries<=5&&(l=40),setTimeout(function(){loopuntilzload(e)},l)}}function getinput(){var e=0,l=window.location.search.substr(1).split(","),a=document.getElementById("myChart"),s=a.offsetHeight;dwidth=a.offsetWidth,1==debugg&&console.log("dheight="+s+"   dwidth="+dwidth),s>400?(a.style.width="101%",a.style.height="101%"):s>357?(a.style.width="102%",a.style.height="104%"):s<270&&(a.style.width="103%",a.style.height="114%"),window.location.search.length<20&&(4!=l.length?e=1:(((days=parseInt(l[1]))<1||days>10||4==days)&&(e=1),(symbolin=l[0]).length>7&&(e=1),0!=(onetime=l[2])&&1!=onetime&&(e=1),stickchart=l[3]),0==e&&(origdays=days,setTimeout(function(){getdata()},1e3),getdata()))}var dwidth,globerr,startt,endt,zloadtries=0,maxloadtries=95;function getdata(){if(timeoutsecs=0,thetimeout&&clearTimeout(thetimeout),0==onetime&&document.hidden){1==debugg&&console.log("I was hidden"),thetimeout=setTimeout(getdata,1e3);return}1==debugg&&console.log("getting data func days="+origdays);var e=new AbortController;globerr=0;var l=setTimeout(()=>e.abort(),4500);fetch("https://www.stockconsultant.com/consultnow/"+cgiprog+".cgi?SYMBOL="+symbolin+"&DAYS="+origdays+"&SDATE="+currentsdate+"&SFIDX="+currentsfidx,{signal:e.signal}).then(e=>(clearTimeout(l),e.ok||(globerr=1,apidatafail++,cyclechart()),e.text())).then(e=>{0==globerr&&(zloadtries=0,loopuntilzload(e))}).catch(e=>{0==globerr&&(apidatafail++,cyclechart())})}