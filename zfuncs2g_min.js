var myConfig,thetimeout,days,origdays,j,dwidth,errorstr="",xhr=[],xhrnum=0,currentsdate="1",currentsfidx="1",cgiprog="screaltime1b5",hadtowaitglob=0,apidatafail=0,onetime=1,stickchart=0;function initconfig(){myConfig={"background-color":"#000",type:"mixed",title:{text:""},plot:{tooltip:{visible:!1},mode:"fast",exact:!0,smartSampling:!1,maxNodes:"100",maxTrackers:"100"},plotarea:{"background-color":"#000",margin:"dynamic"},scaleX:{itemsOverlap:!0,"max-items":100,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px",rules:[{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.7"}]},tick:{alpha:"0",color:"#ddd",rules:[{rule:'"%scale-label" != "" || "%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"1"}]},guide:{visible:!0,zIndex:"0","line-color":"#383838","line-style":"solid",alpha:"0",rules:[{rule:' "%scale-label" != "" || "%scale-label" == "10 " || "%scale-label" == "11 " || "%scale-label" == "12 " || "%scale-label" == "01"|| "%scale-label" == "02" || "%scale-label" == "03"',alpha:"1"},{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.6"}]},labels:[]},scaleY:{itemsOverlap:!0,"max-items":50,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px"},placement:"opposite",decimals:"1","offset-start":"19%",format:"%v",values:"0:1:1",guide:{"line-style":"dotted",zIndex:"0","line-color":"#555"},label:{text:""}},scaleY2:{"max-items":3,item:{"font-family":"Arial",color:"#777",fontSize:"9px"},blended:!0,"offset-end":"86%",placement:"opposite","exponent-decimals":"0",format:"%v",values:"0:1:1",guide:{"line-style":"solid",zIndex:"0","line-color":"#333"},label:{text:""}},series:[{type:"stock",scales:"scaleX,scaleY",zIndex:"1",aspect:"candlestick","bar-width":"100%","trend-up":{"background-color":"#000","line-color":"#00ff00","border-color":"#00ff00"},"trend-down":{"background-color":"#ff1111","line-color":"#ff1111","border-color":"#ff1111"},"trend-equal":{"background-color":"#00ff00","line-color":"#00ff00","border-color":"#00ff00"},values:[]},{type:"bar",scales:"scaleX,scaleY2","background-color":"#00ff00",stacked:!0,"bar-width":"90%",values:[]},{scales:"scaleX,scaleY",zIndex:"0",marker:{visible:"false"},aspect:"spline",lineColor:"#BF48BF",lineWidth:"1px",values:[]},{type:"bar",scales:"scaleX,scaleY2","background-color":"#ff1111",stacked:!0,"bar-width":"90%",values:[]}]}}function decodedata(e){var a,l,s="",t=12,i=0,o=1;if((timeoutsecs=0,1==debugg&&(l=new Date),null!=e)&&(1==debugg&&(console.log(e),console.log("apidatafail="+apidatafail)),1<=(s=e).length&&s.length<=11&&("9"==s?hadtowaitglob=apidatafail=o=0:"6"==s?(i=1,apidatafail++):"5"==s?(i=1,hadtowaitglob++):"1"==s.charAt(0)&&(0<s.indexOf(",")&&(C=s.split(","),C=parseFloat(C[1]),timeoutsecs=1<=C&&C<=3750?C:60),i=1,hadtowaitglob=apidatafail=0)),0==o&&(document.getElementById("status").innerHTML=symbolin+"</span> no chart"),1==debugg&&console.log("*********************************** nochartupdate="+i),1==debugg&&console.log("before currentsdate="+currentsdate+"  currentsfidx="+currentsfidx),1==o&&0==i)){s=s.split("~"),(days>=s.length||(days=origdays)>=s.length)&&(days=s.length);var n,r,c,d=[1,78,39,26,13,13,7,7,7,7,7],g=[1,6,3,2,1,1,1,1,1,1,1],u=-1,f=99999999,m=[],y=0,b=0,h=[0,0,0],p=0;for(initconfig(),W=s.length-1;0<=W;W--){var C,v,w=s[W].indexOf("]"),x=(v=s[W].substr(0,w).split(","))[0].substr(6,2),X=s[W].substr(w+1).split("[");0==W&&(currentsdate=v[0],currentsfidx=v[1],"1"==v[3]?apidatafail++:apidatafail=0,"1"==v[2]?hadtowaitglob++:hadtowaitglob=0,0==timeoutsecs&&5==v.length&&(C=parseFloat(v[4]),timeoutsecs=1<=C&&C<=3650?C:60),1==debugg&&console.log("j="+W+"  currentsdate="+currentsdate+"  currentsfidx="+currentsfidx+"  dataslots[days]="+d[days])),v=X.length,r=0;var z=d[days]-v;if(1==s.length){if(v<d[days])for(I=0;I<z;I++)X.unshift("")}else if(v<d[days])for(I=0;I<z;I++)X.push("");for(var k=0,I=n=-1;I<=d[days];I++){if(-1==I||I==d[days])I==d[days]&&0!=W?y--:(myConfig.scaleX.labels[y]="",myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[y]=0,myConfig.series[3].values[y]=0,myConfig.series[2].values[y]=null);else if(1<days||1==days&&1==k||""!=X[I]){k=1;var T=r/g[days];if(T-Math.floor(T)==0&&T%2==1?(myConfig.scaleX.labels[y]=5<T?.5*(T-1)-2:.5*(T-1)+10,(2==days&&10==myConfig.scaleX.labels[y]||3<=days&&(10==myConfig.scaleX.labels[y]||12==myConfig.scaleX.labels[y]||2==myConfig.scaleX.labels[y])||5==days&&(10==myConfig.scaleX.labels[y]||11==myConfig.scaleX.labels[y]||12==myConfig.scaleX.labels[y]||2==myConfig.scaleX.labels[y]||3==myConfig.scaleX.labels[y])||5<days)&&(myConfig.scaleX.labels[y]=""),""!=myConfig.scaleX.labels[y]&&(myConfig.scaleX.labels[y]<12&&9<myConfig.scaleX.labels[y]?myConfig.scaleX.labels[y]+="a":myConfig.scaleX.labels[y]+="p")):0==r?(A=parseInt(x),myConfig.scaleX.labels[y]=!(A<10||10!=A&&11!=A&&12!=A)?parseInt(x)+" ":x):myConfig.scaleX.labels[y]="",r++,""!=X[I])if(""!=(c=X[I].split(","))[3]){var F=parseFloat(c[1]),Y=parseFloat(c[2]),S=parseInt(c[4]),T=parseFloat(c[0]),A=parseFloat(c[3]);if(u<F&&(u=F),Y<f&&(f=Y),myConfig.series[0].values.push([T,F,Y,A]),b<S&&(b=S),A<T?(myConfig.series[3].values[y]=S,myConfig.series[1].values[y]=0):(myConfig.series[1].values[y]=S,myConfig.series[3].values[y]=0),S>h[0]?(h[2]=h[1],h[1]=h[0],h[0]=S):S>h[1]?(h[2]=h[1],h[1]=S):S>h[2]&&(h[2]=S),p++,n=parseFloat(c[3]),m.unshift(parseFloat(c[3])),m.length>=t){var D=0;for(B=0;B<t;B++)D+=m[B];myConfig.series[2].values[y]=parseFloat((D/t).toFixed(3))}else myConfig.series[2].values[y]=null}else if(0<n)if(myConfig.series[0].values.push([n,n,n,n]),myConfig.series[1].values[y]=0,myConfig.series[3].values[y]=0,m.unshift(n),m.length>=t){var B,D=0;for(B=0;B<t;B++)D+=m[B];myConfig.series[2].values[y]=parseFloat((D/t).toFixed(3))}else myConfig.series[2].values[y]=null;else myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[y]=0,myConfig.series[3].values[y]=0,myConfig.series[2].values[y]=null;else myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[y]=0,myConfig.series[3].values[y]=0,myConfig.series[2].values[y]=null}else myConfig.scaleX.labels[y]="",myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[y]=0,myConfig.series[3].values[y]=0,myConfig.series[2].values[y]=null;y++}}-1!=u&&99999999!=f&&(myConfig.scaleY.values=dwidth<510?f+":"+u+":"+.125*(u-f):f+":"+u+":"+.1*(u-f),myConfig.scaleY.decimals=f<1?"3":f<1e3?"2":"1");var O=0;20<p&&h[0]>2*h[2]&&(O=1,b=h[2]);for(var M=parseInt(.02*b),W=0;W<y;W++)1==O&&(myConfig.series[1].values[W]==h[0]&&(myConfig.series[1].values[W]=h[2]),myConfig.series[3].values[W]==h[0]&&(myConfig.series[3].values[W]=h[2]),myConfig.series[1].values[W]==h[1]&&(myConfig.series[1].values[W]=h[2]),myConfig.series[3].values[W]==h[1]&&(myConfig.series[3].values[W]=h[2])),0<myConfig.series[1].values[W]&&myConfig.series[1].values[W]<M&&(myConfig.series[1].values[W]=M),0<myConfig.series[3].values[W]&&myConfig.series[3].values[W]<M&&(myConfig.series[3].values[W]=M),myConfig.scaleX.labels[W]=myConfig.scaleX.labels[W].toString();0<b&&(myConfig.scaleY2.values="0:"+b+":"+parseInt(.5*b)),dwidth<510&&(myConfig.series[1].barWidth="60%",myConfig.series[3].barWidth="60%"),myConfig.series[0].aspect=0==stickchart?"candlestick":"whisker",(u<10&&49900<b||u<100&&499e3<b)&&(myConfig.scaleY2.exponent=!0,myConfig.scaleY2.item.fontSize="10px"),1==debugg&&(a=new Date,console.log("setup vars time="+(a.getTime()-l.getTime())/1e3),a=new Date),zingchart.render({id:"myChart",data:myConfig,height:"100%",width:"100%"}),zingchart.bind("myChart","contextmenu",function(e){return!1}),zingchart.bind("myChart","mousewheel",function(e){return!1}),zingchart.bind("myChart","swipe",function(e){return!1}),1==debugg&&(l=new Date,console.log("setup render time="+(l.getTime()-a.getTime())/1e3))}}function cyclechart(){0==onetime&&1!=apidatafail&&1!=hadtowaitglob&&(apidatafail=hadtowaitglob=0,timeoutsecs=parseInt(1e3*timeoutsecs),0==timeoutsecs&&(timeoutsecs=6e4),1==debugg&&console.log("normal getting data secs="+timeoutsecs),thetimeout=setTimeout(function(){getdata()},timeoutsecs)),1==apidatafail?(hadtowaitglob=0,1==debugg&&console.log("api fail or timeout getting data 1 secs"),thetimeout=setTimeout(function(){getdata()},1e3)):apidatafail=0,0==onetime&&1==hadtowaitglob?(1==debugg&&console.log("had to wait getting data 5 secs"),thetimeout=setTimeout(function(){getdata()},5e3)):hadtowaitglob=0}function loopuntilzload(e){var a;1==zingloaded?(1==debugg&&console.log("zingloaded in times="+zloadtries),decodedata(e),cyclechart()):maxloadtries<++zloadtries||(a=100,zloadtries<=3?a=20:zloadtries<=5&&(a=40),setTimeout(function(){loopuntilzload(e)},a))}function getinput(){var e=0,a=window.location.search.substr(1).split(","),l=document.getElementById("myChart"),s=l.offsetHeight;dwidth=l.offsetWidth,1==debugg&&console.log("dheight="+s+"   dwidth="+dwidth),400<s?(l.style.width="101%",l.style.height="101%"):357<s?(l.style.width="102%",l.style.height="104%"):s<270&&(l.style.width="103%",l.style.height="114%"),window.location.search.length<20&&(4!=a.length?e=1:(((days=parseInt(a[1]))<1||10<days||4==days)&&(e=1),symbolin=a[0],7<symbolin.length&&(e=1),0!=(onetime=a[2])&&1!=onetime&&(e=1),stickchart=a[3]),0==e&&(origdays=days,getdata()))}var globerr,startt,endt,zloadtries=0,maxloadtries=95;function getdata(){if(timeoutsecs=0,thetimeout&&clearTimeout(thetimeout),0==onetime&&document.hidden)return 1==debugg&&console.log("I was hidden"),void(thetimeout=setTimeout(getdata,1e3));1==debugg&&console.log("getting data func days="+origdays);var e=new AbortController,a=parseInt(5e6*Math.random());globerr=0;var l=setTimeout(()=>e.abort(),4500);fetch("https://www.stockconsultant.com/consultnow/"+cgiprog+".cgi?SYMBOL="+symbolin+"&DAYS="+origdays+"&SDATE="+currentsdate+"&SFIDX="+currentsfidx+"&"+a,{signal:e.signal}).then(e=>(clearTimeout(l),e.ok||(globerr=1,apidatafail++,cyclechart()),e.text())).then(e=>{0==globerr&&(zloadtries=0,loopuntilzload(e))}).catch(e=>{clearTimeout(l),0==globerr&&(apidatafail++,cyclechart())})}