var myConfig,thetimeout,days,origdays,j,dwidth,errorstr="",xhr=[],xhrnum=0,currentsdate="1",currentsfidx="1",cgiprog="screaltime1b5",hadtowaitglob=0,apidatafail=0,onetime=1,stickchart=0;function initconfig(){myConfig={"background-color":"#111111",type:"mixed",title:{text:""},crosshairX:{lineColor:"#888888",lineStyle:"dotted"},plot:{tooltip:{visible:!1},mode:"fast",exact:!0,smartSampling:!1,maxNodes:"100",maxTrackers:"100"},plotarea:{"background-color":"#111111",margin:"dynamic"},scaleX:{itemsOverlap:!0,"max-items":100,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px",rules:[{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.7"}]},tick:{alpha:"0",color:"#ddd",rules:[{rule:'"%scale-label" != "" || "%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"1"}]},guide:{visible:!0,zIndex:"0","line-color":"#383838","line-style":"solid",alpha:"0",rules:[{rule:' "%scale-label" != "" || "%scale-label" == "10 " || "%scale-label" == "11 " || "%scale-label" == "12 " || "%scale-label" == "01"|| "%scale-label" == "02" || "%scale-label" == "03"',alpha:"1"},{rule:'"%scale-label" == "10a" || "%scale-label" == "11a" || "%scale-label" == "12p" || "%scale-label" == "1p" || "%scale-label" == "2p" || "%scale-label" == "3p"',alpha:"0.6"}]},labels:[]},scaleY:{itemsOverlap:!0,"max-items":50,item:{"font-family":"Arial",color:"#e4e4e4",fontSize:"12px"},placement:"opposite",decimals:"1","offset-start":"19%",format:"%v",values:"0:1:1",guide:{"line-style":"dotted",zIndex:"0","line-color":"#555"},label:{text:""}},scaleY2:{"max-items":3,item:{"font-family":"Arial",color:"#777",fontSize:"9px"},blended:!0,"offset-end":"86%",placement:"opposite","exponent-decimals":"0",format:"%v",values:"0:1:1",guide:{"line-style":"solid",zIndex:"0","line-color":"#333"},label:{text:""}},series:[{type:"stock",scales:"scaleX,scaleY",zIndex:"1",aspect:"candlestick","bar-width":"100%",guideLabel:{text:"High: %high<br>Open: %open<br>Close: %close<br>Low: %low",decimals:2,fontColor:"#dddddd",backgroundColor:"#333333",fontFamily:"Arial",fontSize:15,borderWidth:"1px",borderColor:"gray",borderRadius:"5px"},"trend-up":{"background-color":"#00d100","line-color":"#00d100","border-color":"#00d100"},"trend-down":{"background-color":"#ff2216","line-color":"#ff645b","border-color":"#ff2216"},"trend-equal":{"background-color":"#00d100","line-color":"#00d100","border-color":"#00d100"},values:[]},{type:"bar",scales:"scaleX,scaleY2",guideLabel:{visible:!1},"background-color":"#00d100",stacked:!0,"bar-width":"90%",values:[]},{scales:"scaleX,scaleY",guideLabel:{visible:!1},zIndex:"0",marker:{visible:"false"},aspect:"spline",lineColor:"#7777cc",lineWidth:"1px",values:[]},{type:"bar",guideLabel:{visible:!1},scales:"scaleX,scaleY2","background-color":"#ff2216",stacked:!0,"bar-width":"90%",values:[]}]}}function decodedata(e){var l,a,s,t,i="",o=12,n=0,r=1;if(timeoutsecs=0,1==debugg&&(a=new Date),null!=e){if(1==debugg&&(console.log(e),console.log("apidatafail="+apidatafail)),(i=e).length>=1&&i.length<=11)if("9"==i)r=0,apidatafail=0,hadtowaitglob=0;else if("6"==i)n=1,apidatafail++;else if("5"==i)n=1,hadtowaitglob++;else if("1"==i.charAt(0)){if(i.indexOf(",")>0){var d=i.split(",");d=parseFloat(d[1]),timeoutsecs=d>=1&&d<=3750?d:60}n=1,apidatafail=0,hadtowaitglob=0}if(0==r&&(document.getElementById("status").innerHTML=symbolin+"</span> no chart"),1==debugg&&console.log("*********************************** nochartupdate="+n),1==debugg&&console.log("before currentsdate="+currentsdate+"  currentsfidx="+currentsfidx),1==r&&0==n){i=i.split("~"),(days>=i.length||(days=origdays)>=i.length)&&(days=i.length);var c,g,u,m,f,y,b,h,p,C,v=[1,78,39,26,13,13,7,7,7,7,7],w=[1,6,3,2,1,1,1,1,1,1,1],x=-1,I=99999999,X=[],z=0,k=0,T=[0,0,0],E=0;for(initconfig(),C=i.length-1;C>=0;C--){if(f=i[C].indexOf("]"),b=(y=i[C].substr(0,f).split(","))[0].substr(6,2),h=i[C].substr(f+1).split("["),0==C){if(currentsdate=y[0],currentsfidx=y[1],"1"==y[3]?apidatafail++:apidatafail=0,"1"==y[2]?hadtowaitglob++:hadtowaitglob=0,0==timeoutsecs&&5==y.length){d=parseFloat(y[4]);timeoutsecs=d>=1&&d<=3650?d:60}1==debugg&&console.log("j="+C+"  currentsdate="+currentsdate+"  currentsfidx="+currentsfidx+"  dataslots[days]="+v[days])}m=h.length,u=0;var F=v[days]-m;if(1==i.length){if(m<v[days])for(g=0;g<F;g++)h.unshift("")}else if(m<v[days])for(g=0;g<F;g++)h.push("");c=-1;var Y=0;for(g=-1;g<=v[days];g++){if(-1==g||g==v[days])g==v[days]&&0!=C?z--:(myConfig.scaleX.labels[z]="",myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[z]=0,myConfig.series[3].values[z]=0,myConfig.series[2].values[z]=null);else if(days>1||1==days&&1==Y||""!=h[g]){Y=1;var B=u/w[days];if(B-Math.floor(B)==0&&B%2==1)myConfig.scaleX.labels[z]=B>5?.5*(B-1)-2:.5*(B-1)+10,2==days&&10==myConfig.scaleX.labels[z]||days>=3&&(10==myConfig.scaleX.labels[z]||12==myConfig.scaleX.labels[z]||2==myConfig.scaleX.labels[z])?myConfig.scaleX.labels[z]="":5!=days||10!=myConfig.scaleX.labels[z]&&11!=myConfig.scaleX.labels[z]&&12!=myConfig.scaleX.labels[z]&&2!=myConfig.scaleX.labels[z]&&3!=myConfig.scaleX.labels[z]?days>5&&(myConfig.scaleX.labels[z]=""):myConfig.scaleX.labels[z]="",""!=myConfig.scaleX.labels[z]&&(myConfig.scaleX.labels[z]<12&&myConfig.scaleX.labels[z]>9?myConfig.scaleX.labels[z]+="a":myConfig.scaleX.labels[z]+="p");else if(0==u){var S=parseInt(b);myConfig.scaleX.labels[z]=S<10?b:10==S||11==S||12==S?parseInt(b)+" ":b}else myConfig.scaleX.labels[z]="";if(u++,""!=h[g])if(""!=(p=h[g].split(","))[3]){var A=parseFloat(p[1]),L=parseFloat(p[2]),D=parseInt(p[4]),H=parseFloat(p[0]),O=parseFloat(p[3]);if(A>x&&(x=A),L<I&&(I=L),myConfig.series[0].values.push([H,A,L,O]),D>k&&(k=D),O<H?(myConfig.series[3].values[z]=D,myConfig.series[1].values[z]=0):(myConfig.series[1].values[z]=D,myConfig.series[3].values[z]=0),D>T[0]?(T[2]=T[1],T[1]=T[0],T[0]=D):D>T[1]?(T[2]=T[1],T[1]=D):D>T[2]&&(T[2]=D),E++,c=parseFloat(p[3]),X.unshift(parseFloat(p[3])),X.length>=o){var W=0;for(M=0;M<o;M++)W+=X[M];myConfig.series[2].values[z]=parseFloat((W/o).toFixed(3))}else myConfig.series[2].values[z]=null}else if(c>0)if(myConfig.series[0].values.push([c,c,c,c]),myConfig.series[1].values[z]=0,myConfig.series[3].values[z]=0,X.unshift(c),X.length>=o){var M;W=0;for(M=0;M<o;M++)W+=X[M];myConfig.series[2].values[z]=parseFloat((W/o).toFixed(3))}else myConfig.series[2].values[z]=null;else myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[z]=0,myConfig.series[3].values[z]=0,myConfig.series[2].values[z]=null;else myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[z]=0,myConfig.series[3].values[z]=0,myConfig.series[2].values[z]=null}else myConfig.scaleX.labels[z]="",myConfig.series[0].values.push([null,null,null,null]),myConfig.series[1].values[z]=0,myConfig.series[3].values[z]=0,myConfig.series[2].values[z]=null;z++}}-1!=x&&99999999!=I&&(myConfig.scaleY.values=dwidth<510?I+":"+x+":"+.125*(x-I):I+":"+x+":"+.1*(x-I),myConfig.scaleY.decimals=I<1?"3":I<1e3?"2":"1");var j=0;E>20&&T[0]>2*T[2]&&(j=1,k=T[2]);var U=parseInt(.02*k);for(C=0;C<z;C++)1==j&&(myConfig.series[1].values[C]==T[0]&&(myConfig.series[1].values[C]=T[2]),myConfig.series[3].values[C]==T[0]&&(myConfig.series[3].values[C]=T[2]),myConfig.series[1].values[C]==T[1]&&(myConfig.series[1].values[C]=T[2]),myConfig.series[3].values[C]==T[1]&&(myConfig.series[3].values[C]=T[2])),myConfig.series[1].values[C]>0&&myConfig.series[1].values[C]<U&&(myConfig.series[1].values[C]=U),myConfig.series[3].values[C]>0&&myConfig.series[3].values[C]<U&&(myConfig.series[3].values[C]=U),myConfig.scaleX.labels[C]=myConfig.scaleX.labels[C].toString();k>0&&(myConfig.scaleY2.values="0:"+k+":"+parseInt(.5*k)),dwidth<510&&(myConfig.series[1].barWidth="60%",myConfig.series[3].barWidth="60%"),myConfig.series[0].aspect=0==stickchart?"candlestick":"whisker",(x<10&&k>49900||x<100&&k>499e3)&&(myConfig.scaleY2.exponent=!0,myConfig.scaleY2.item.fontSize="10px"),1==debugg&&(s=new Date,console.log("setup vars time="+(s.getTime()-a.getTime())/1e3),l=new Date),zingchart.render({id:"myChart",data:myConfig,height:"100%",width:"100%"}),zingchart.bind("myChart","contextmenu",(function(e){return!1})),zingchart.bind("myChart","mousewheel",(function(e){return!1})),zingchart.bind("myChart","swipe",(function(e){return!1})),1==debugg&&(t=new Date,console.log("setup render time="+(t.getTime()-l.getTime())/1e3))}}}function cyclechart(){0==onetime&&1!=apidatafail&&1!=hadtowaitglob&&(hadtowaitglob=0,apidatafail=0,timeoutsecs=parseInt(1e3*timeoutsecs),0==timeoutsecs&&(timeoutsecs=6e4),1==debugg&&console.log("normal getting data secs="+timeoutsecs),thetimeout=setTimeout((function(){getdata()}),timeoutsecs)),1==apidatafail?(hadtowaitglob=0,1==debugg&&console.log("api fail or timeout getting data 1 secs"),thetimeout=setTimeout((function(){getdata()}),1e3)):apidatafail=0,0==onetime&&1==hadtowaitglob?(1==debugg&&console.log("had to wait getting data 5 secs"),thetimeout=setTimeout((function(){getdata()}),5e3)):hadtowaitglob=0}function loopuntilzload(e){if(1==zingloaded)1==debugg&&console.log("zingloaded in times="+zloadtries),decodedata(e),cyclechart();else{if(++zloadtries>maxloadtries)return;var l=100;zloadtries<=3?l=20:zloadtries<=5&&(l=40),setTimeout((function(){loopuntilzload(e)}),l)}}function getinput(){var e=0,l=window.location.search.substr(1).split(","),a=document.getElementById("myChart");if(dwidth=a.offsetWidth,a.style.height=zinght,a.style.height=document.getElementById("myChart").offsetHeight-document.getElementById("dataline").offsetHeight-1+"px",window.location.search.length<20&&(4!=l.length?e=1:(((days=parseInt(l[1]))<1||days>10||4==days)&&(e=1),symbolin=l[0],symbolin.length>7&&(e=1),0!=(onetime=l[2])&&1!=onetime&&(e=1),stickchart=l[3]),0==e)){origdays=days,document.getElementById("symid").value=symbolin.toUpperCase();var s=document.getElementById("daysel");1==days?s.selectedIndex=0:2==days?s.selectedIndex=1:3==days?s.selectedIndex=2:5==days?s.selectedIndex=3:10==days&&(s.selectedIndex=4),getdata()}}function spawnwindow(e){var l="https://www.stockconsultant.com/consultnow/rtime1b_multi.html?"+document.getElementById("symid").value+","+document.getElementById("daysel").value+","+onetime+","+stickchart;if(1==e){var a=window.open(l,"_blank","resizable=1,directories=0,toolbar=0,location=0,menubar=0,status=0,scrollbars=0,width=700,height=400,left=5,top=5,screenX=5,screenY=5");a&&!a.closed&&a.focus()}else window.location.href=l}window.addEventListener("resize",(function(){var e=document.getElementById("myChart");e.style.height="100%",e.style.height=document.getElementById("myChart").offsetHeight-document.getElementById("dataline").offsetHeight-1+"px"})),document.getElementById("symid").onkeyup=function(){this.value=this.value.toUpperCase()};var globerr,startt,endt,zloadtries=0,maxloadtries=95;function getdata(){if(timeoutsecs=0,thetimeout&&clearTimeout(thetimeout),0==onetime&&document.hidden)return 1==debugg&&console.log("I was hidden"),void(thetimeout=setTimeout(getdata,1e3));1==debugg&&console.log("getting data func days="+origdays);var e=new AbortController,l=parseInt(5e6*Math.random());globerr=0;var a=setTimeout((()=>e.abort()),4500);fetch("https://www.stockconsultant.com/consultnow/"+cgiprog+".cgi?SYMBOL="+symbolin+"&DAYS="+origdays+"&SDATE="+currentsdate+"&SFIDX="+currentsfidx+"&"+l,{signal:e.signal}).then((e=>(clearTimeout(a),e.ok||(globerr=1,apidatafail++,cyclechart()),e.text()))).then((e=>{0==globerr&&(zloadtries=0,loopuntilzload(e))})).catch((e=>{clearTimeout(a),0==globerr&&(apidatafail++,cyclechart())}))}